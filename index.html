<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Lista de Compras Compartilhada</title>
<meta name="theme-color" content="#0f172a">
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- Firebase v10 -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
  :root{
    --bg:#0f172a;--card:#111827;--muted:#94a3b8;--fg:#e5e7eb;
    --accent:#22c55e;--accent-2:#16a34a;--danger:#ef4444;
    --warning:#f59e0b;--info:#3b82f6;
  }
  *{box-sizing:border-box}
  body{
    margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    background:var(--bg);color:var(--fg);line-height:1.5;
  }
  
  header{
    position:sticky;top:0;z-index:10;
    background:linear-gradient(180deg,#0f172a,#0f172acc);
    backdrop-filter:blur(10px);padding:12px 16px;
    border-bottom:1px solid #1f2937;box-shadow:0 1px 3px rgba(0,0,0,.3);
  }
  
  .row{display:flex;gap:12px;align-items:center}
  .col{display:flex;flex-direction:column;gap:8px}
  .brand{font-weight:700;letter-spacing:.3px;font-size:1.1rem}
  .chip{
    font-size:.8rem;color:var(--muted);border:1px solid #1f2937;
    border-radius:999px;padding:6px 12px;background:#0b1220;
  }
  
  .wrap{max-width:800px;margin:0 auto;padding:16px}
  .card{
    background:var(--card);border:1px solid #1f2937;
    border-radius:16px;padding:16px;margin-bottom:16px;
  }
  
  input,select,button,textarea{
    border-radius:12px;border:1px solid #334155;
    background:#0b1220;color:var(--fg);padding:12px 14px;
    font-size:1rem;transition:all .2s ease;
  }
  
  input:focus,select:focus,textarea:focus{
    outline:none;border-color:var(--accent);
    box-shadow:0 0 0 2px rgba(34,197,94,.2);
  }
  
  input::placeholder{color:#64748b}
  
  button{
    background:var(--accent);border:none;color:#04210f;
    font-weight:600;cursor:pointer;transition:all .2s ease;
  }
  button:hover{background:var(--accent-2);transform:translateY(-1px)}
  button:active{transform:translateY(0)}
  
  .btn-ghost{background:#0b1220;border:1px solid #223147;color:var(--fg)}
  .btn-ghost:hover{background:#223147}
  
  .btn-danger{background:var(--danger);color:white}
  .btn-danger:hover{background:#dc2626}
  
  .btn-warning{background:var(--warning);color:#0c0a09}
  .btn-warning:hover{background:#d97706}
  
  .grid{display:grid;gap:12px;align-items:center}
  .grid-2{grid-template-columns:1fr auto}
  .grid-3{grid-template-columns:1fr auto auto}
  .grid-4{grid-template-columns:1fr auto auto auto}
  
  .list{margin-top:16px;display:grid;gap:10px}
  .item{
    display:grid;grid-template-columns:auto 1fr auto auto auto;
    align-items:center;gap:12px;background:#0b1220;
    border:1px solid #223147;border-radius:14px;padding:12px;
    transition:all .2s ease;
  }
  .item:hover{border-color:#334155}
  .item.checked{opacity:.6;background:#0a1017}
  
  .checkbox{
    width:20px;height:20px;accent-color:var(--accent);
    cursor:pointer;
  }
  
  .qty{
    min-width:50px;text-align:center;border:1px solid #223147;
    border-radius:10px;padding:8px 10px;background:#0b1220;
    color:var(--fg);font-weight:500;
  }
  
  .cat{font-size:.85rem;color:var(--muted);font-weight:500}
  .muted{color:var(--muted)}
  .small{font-size:.9rem}
  
  .tools{
    display:flex;flex-wrap:wrap;gap:12px;margin:16px 0;
    align-items:center;
  }
  
  .stats{
    display:flex;gap:16px;flex-wrap:wrap;margin:12px 0;
  }
  .stat{
    background:#0b1220;border:1px solid #223147;
    border-radius:8px;padding:8px 12px;text-align:center;
  }
  .stat-num{font-size:1.2rem;font-weight:700;color:var(--accent)}
  .stat-label{font-size:.8rem;color:var(--muted)}
  
  .templates{margin:16px 0}
  .template-btn{
    background:#1e293b;border:1px solid #334155;
    color:var(--fg);margin:4px;padding:8px 12px;
    border-radius:8px;cursor:pointer;font-size:.9rem;
  }
  .template-btn:hover{background:#334155}
  
  .footer{
    margin:32px 0 16px;color:#64748b;font-size:.9rem;
    text-align:center;border-top:1px solid #1f2937;
    padding-top:16px;
  }
  
  .toast{
    position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
    background:#0b1220;border:1px solid #334155;color:#e5e7eb;
    padding:12px 16px;border-radius:12px;opacity:0;
    transition:all .3s ease;z-index:999;box-shadow:0 4px 12px rgba(0,0,0,.4);
  }
  .toast.show{opacity:1;transform:translateX(-50%) translateY(-8px)}
  
  .offline{background:#f59e0b;color:#0c0a09;font-weight:600}
  .online{background:#22c55e;color:#04210f;font-weight:600}
  
  @media (max-width: 640px) {
    .wrap{padding:12px}
    .grid-3{grid-template-columns:1fr auto}
    .grid-4{grid-template-columns:1fr auto}
    .row{flex-wrap:wrap}
    .stats{justify-content:center}
  }
</style>
</head>

<body>
<header class="wrap">
  <div class="row" style="justify-content:space-between;flex-wrap:wrap">
    <div class="col" style="gap:4px">
      <div class="brand">🛒 Lista de Compras</div>
      <div class="small" id="statusLine">Conectando…</div>
    </div>
    <div class="row" style="gap:8px;flex-wrap:wrap">
      <div class="chip" id="statusChip">Offline</div>
      <div class="chip" id="houseChip">Casa: —</div>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- Login -->
  <section id="authCard" class="card" style="display:none">
    <h3>🏠 Entrar na Lista da Casa</h3>
    <div class="col">
      <label for="houseCode"><strong>Código da casa</strong></label>
      <input id="houseCode" placeholder="Ex.: FAMILIA-SILVA" autocomplete="off">
      <button id="enterBtn">🔑 Entrar</button>
      <div class="muted small">
        💡 <strong>Dica:</strong> Use um código único para sua família. 
        Todos com o código poderão editar a lista.
      </div>
    </div>
  </section>

  <!-- App Principal -->
  <section id="appCard" class="card" style="display:none">
    
    <!-- Estatísticas -->
    <div class="stats">
      <div class="stat">
        <div class="stat-num" id="totalItems">0</div>
        <div class="stat-label">Total</div>
      </div>
      <div class="stat">
        <div class="stat-num" id="pendingItems">0</div>
        <div class="stat-label">Pendentes</div>
      </div>
      <div class="stat">
        <div class="stat-num" id="checkedItems">0</div>
        <div class="stat-label">Comprados</div>
      </div>
    </div>

    <!-- Filtros -->
    <div class="grid grid-2" style="gap:12px">
      <input id="search" placeholder="🔍 Buscar item…">
      <select id="filterCat">
        <option value="">📂 Todas categorias</option>
        <option>🥬 Hortifruti</option>
        <option>🛒 Mercearia</option>
        <option>🧽 Limpeza</option>
        <option>🥤 Bebidas</option>
        <option>🧴 Higiene</option>
        <option>🥖 Padaria</option>
        <option>🍖 Açougue</option>
        <option>🧊 Congelados</option>
      </select>
    </div>

    <!-- Adicionar Item -->
    <div class="grid grid-4" style="margin-top:16px">
      <input id="itemName" placeholder="➕ Novo item (ex.: Arroz)">
      <select id="itemCat">
        <option>🛒 Mercearia</option>
        <option>🥬 Hortifruti</option>
        <option>🧽 Limpeza</option>
        <option>🥤 Bebidas</option>
        <option>🧴 Higiene</option>
        <option>🥖 Padaria</option>
        <option>🍖 Açougue</option>
        <option>🧊 Congelados</option>
      </select>
      <input id="itemQty" type="number" value="1" min="1" max="99" style="max-width:80px">
      <button id="addBtn">Adicionar</button>
    </div>

    <!-- Templates de Lista -->
    <div class="templates">
      <div style="margin-bottom:8px"><strong>📋 Templates Rápidos:</strong></div>
      <div>
        <button class="template-btn" data-template="basicos">🥣 Básicos</button>
        <button class="template-btn" data-template="limpeza">🧽 Limpeza</button>
        <button class="template-btn" data-template="higiene">🧴 Higiene</button>
        <button class="template-btn" data-template="frutas">🍎 Frutas</button>
        <button class="template-btn" data-template="verduras">🥬 Verduras</button>
      </div>
    </div>

    <!-- Ferramentas -->
    <div class="tools">
      <button id="clearChecked" class="btn-danger">🗑️ Limpar Comprados</button>
      <button id="clearAll" class="btn-warning">⚠️ Limpar Tudo</button>
      <button id="exportList" class="btn-ghost">📤 Exportar</button>
      <div class="muted" style="margin-left:auto">
        Última atualização: <span id="lastUpdate">—</span>
      </div>
    </div>

    <!-- Lista de Itens -->
    <div id="list" class="list" aria-live="polite"></div>

    <div id="emptyState" style="text-align:center;padding:32px;color:var(--muted);display:none">
      📝 <br><br> <strong>Lista vazia!</strong><br>
      Adicione itens ou use um template acima.
    </div>
  </section>
</main>

<div class="footer">
  <div>💚 <strong>Lista de Compras Compartilhada</strong></div>
  <div class="small muted">Funciona offline • Sincroniza automaticamente • Gratuito para sempre</div>
</div>

<div class="toast" id="toast">✅ Pronto!</div>

<script>
/* ===== Configuração Firebase ===== */
const firebaseConfig = {
  apiKey: "AIzaSyC5Qx9REGwO6vjTFQBcgFx4lcPi7Hz3LFg",
  authDomain: "lista-mercado-713c5.firebaseapp.com",
  projectId: "lista-mercado-713c5",
  storageBucket: "lista-mercado-713c5.appspot.com",
  messagingSenderId: "728322221496",
  appId: "1:728322221496:web:180e0ec1a6f30ad1d35b4d"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ===== Templates de Listas ===== */
const TEMPLATES = {
  basicos: [
    {name: 'Arroz', cat: '🛒 Mercearia'}, 
    {name: 'Feijão', cat: '🛒 Mercearia'},
    {name: 'Açúcar', cat: '🛒 Mercearia'}, 
    {name: 'Sal', cat: '🛒 Mercearia'},
    {name: 'Óleo', cat: '🛒 Mercearia'}, 
    {name: 'Café', cat: '🛒 Mercearia'}
  ],
  limpeza: [
    {name: 'Detergente', cat: '🧽 Limpeza'}, 
    {name: 'Sabão em pó', cat: '🧽 Limpeza'},
    {name: 'Desinfetante', cat: '🧽 Limpeza'}, 
    {name: 'Papel higiênico', cat: '🧽 Limpeza'},
    {name: 'Esponja', cat: '🧽 Limpeza'}
  ],
  higiene: [
    {name: 'Pasta de dente', cat: '🧴 Higiene'}, 
    {name: 'Sabonete', cat: '🧴 Higiene'},
    {name: 'Shampoo', cat: '🧴 Higiene'}, 
    {name: 'Condicionador', cat: '🧴 Higiene'},
    {name: 'Desodorante', cat: '🧴 Higiene'}
  ],
  frutas: [
    {name: 'Banana', cat: '🥬 Hortifruti'}, 
    {name: 'Maçã', cat: '🥬 Hortifruti'},
    {name: 'Laranja', cat: '🥬 Hortifruti'}, 
    {name: 'Limão', cat: '🥬 Hortifruti'},
    {name: 'Abacaxi', cat: '🥬 Hortifruti'}
  ],
  verduras: [
    {name: 'Alface', cat: '🥬 Hortifruti'}, 
    {name: 'Tomate', cat: '🥬 Hortifruti'},
    {name: 'Cebola', cat: '🥬 Hortifruti'}, 
    {name: 'Cenoura', cat: '🥬 Hortifruti'},
    {name: 'Batata', cat: '🥬 Hortifruti'}
  ]
};

/* ===== Utilidades ===== */
const $ = sel => document.querySelector(sel);
const toast = (msg='✅ Pronto!', type='success') => { 
  const t = $("#toast"); 
  t.textContent = msg; 
  t.className = `toast show ${type}`;
  setTimeout(() => t.classList.remove('show'), 2500); 
};

const formatDate = (date) => {
  if(!date) return '—';
  return new Intl.DateTimeFormat('pt-BR', {
    day: '2-digit', month: '2-digit', 
    hour: '2-digit', minute: '2-digit'
  }).format(date.toDate ? date.toDate() : date);
};

/* ===== Estado ===== */
let DEVICE_ID = localStorage.getItem('cc_device') || (() => {
  const id = crypto.randomUUID();
  localStorage.setItem('cc_device', id);
  return id;
})();

let HOUSE_CODE = (localStorage.getItem('cc_house') || '').trim().toUpperCase();
let items = [];
let unsubscribe = null;

/* ===== Monitoramento de Conectividade ===== */
function updateConnectionStatus() {
  const online = navigator.onLine;
  const statusChip = $("#statusChip");
  const statusLine = $("#statusLine");
  
  if(online) {
    statusChip.textContent = "🟢 Online";
    statusChip.className = "chip online";
    statusLine.textContent = "Conectado e sincronizando";
  } else {
    statusChip.textContent = "🔴 Offline";
    statusChip.className = "chip offline";  
    statusLine.textContent = "Modo offline ativo";
  }
}

window.addEventListener('online', updateConnectionStatus);
window.addEventListener('offline', updateConnectionStatus);

/* ===== Fluxo inicial ===== */
function start(){
  updateConnectionStatus();
  
  if(!HOUSE_CODE) { 
    $("#authCard").style.display = 'block'; 
  } else { 
    $("#houseChip").textContent = `🏠 ${HOUSE_CODE}`;
    loginAnon(); 
  }
  
  $("#enterBtn").onclick = () => {
    const code = $("#houseCode").value.trim().toUpperCase();
    if(!code) return toast('❌ Digite um código válido', 'error');
    if(code.length < 3) return toast('❌ Código muito curto', 'error');
    
    HOUSE_CODE = code;
    localStorage.setItem('cc_house', HOUSE_CODE);
    $("#houseChip").textContent = `🏠 ${HOUSE_CODE}`;
    $("#authCard").style.display = 'none';
    toast('🔑 Conectado à casa!');
    loginAnon();
  };

  // Enter para login
  $("#houseCode").addEventListener('keypress', (e) => {
    if(e.key === 'Enter') $("#enterBtn").click();
  });
}

/* ===== Login anônimo (sem limite de dispositivos) ===== */
async function loginAnon(){
  try {
    await auth.signInAnonymously();
    $("#statusLine").textContent = "✅ Autenticado com sucesso";
    initUI();
    bindRealtime();
  } catch(e) {
    console.error('Erro de autenticação:', e);
    $("#statusLine").textContent = "❌ Erro na autenticação";
    toast('❌ Erro de conexão. Tentando novamente...', 'error');
    
    // Retry após 3 segundos
    setTimeout(() => loginAnon(), 3000);
  }
}

/* ===== Interface ===== */
function initUI(){
  $("#appCard").style.display = 'block';
  
  // Event listeners
  $("#addBtn").onclick = addItem;
  $("#search").oninput = debounce(render, 300);
  $("#filterCat").onchange = render;
  $("#clearChecked").onclick = clearChecked;
  $("#clearAll").onclick = clearAll;
  $("#exportList").onclick = exportList;
  $("#itemQty").onchange = validateQty;
  
  // Enter para adicionar item
  $("#itemName").addEventListener('keypress', (e) => {
    if(e.key === 'Enter') addItem();
  });
  
  // Templates
  document.querySelectorAll('.template-btn').forEach(btn => {
    btn.onclick = () => addTemplate(btn.dataset.template);
  });
}

/* ===== Firestore ===== */
function bindRealtime(){
  const col = db.collection('houses').doc(HOUSE_CODE).collection('items');
  
  if(unsubscribe) unsubscribe();
  
  unsubscribe = col
    .orderBy('checked', 'asc')
    .orderBy('updatedAt', 'desc')
    .onSnapshot(snapshot => {
      items = [];
      let lastUpdate = null;
      
      snapshot.forEach(doc => {
        const data = doc.data();
        items.push({id: doc.id, ...data});
        
        if(data.updatedAt && (!lastUpdate || data.updatedAt > lastUpdate)) {
          lastUpdate = data.updatedAt;
        }
      });
      
      $("#lastUpdate").textContent = formatDate(lastUpdate);
      render();
      updateStats();
    }, error => {
      console.error('Erro no listener:', error);
      toast('⚠️ Problema de sincronização', 'warning');
    });
}

async function addItem(){
  const name = $("#itemName").value.trim();
  const category = $("#itemCat").value;
  const qty = parseInt($("#itemQty").value) || 1;
  
  if(!name) return toast('❌ Digite o nome do item', 'error');
  if(name.length < 2) return toast('❌ Nome muito curto', 'error');
  
  // Verificar duplicatas
  const exists = items.some(item => 
    item.name.toLowerCase() === name.toLowerCase() && !item.checked
  );
  
  if(exists) return toast('⚠️ Item já existe na lista', 'warning');
  
  const doc = { 
    name, 
    category, 
    qty: Math.max(1, Math.min(99, qty)), 
    checked: false, 
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    updatedAt: firebase.firestore.FieldValue.serverTimestamp(), 
    updatedBy: DEVICE_ID 
  };
  
  try {
    await db.collection('houses').doc(HOUSE_CODE).collection('items').add(doc);
    $("#itemName").value = '';
    $("#itemQty").value = '1';
    toast(`➕ ${name} adicionado!`);
  } catch(error) {
    console.error('Erro ao adicionar:', error);
    toast('❌ Erro ao adicionar item', 'error');
  }
}

async function addTemplate(template) {
  if(!TEMPLATES[template]) return;
  
  const items_to_add = TEMPLATES[template];
  let added = 0;
  
  for(const item of items_to_add) {
    const exists = items.some(existing => 
      existing.name.toLowerCase() === item.name.toLowerCase() && !existing.checked
    );
    
    if(!exists) {
      const doc = {
        name: item.name,
        category: item.cat,
        qty: 1,
        checked: false,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedBy: DEVICE_ID
      };
      
      try {
        await db.collection('houses').doc(HOUSE_CODE).collection('items').add(doc);
        added++;
      } catch(error) {
        console.error('Erro no template:', error);
      }
    }
  }
  
  toast(`📋 Template aplicado! ${added} itens adicionados.`);
}

async function toggleCheck(id, checked){
  try {
    await db.collection('houses').doc(HOUSE_CODE).collection('items').doc(id).update({
      checked,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
      updatedBy: DEVICE_ID
    });
  } catch(error) {
    console.error('Erro ao atualizar:', error);
    toast('❌ Erro ao atualizar item', 'error');
  }
}

async function updateQty(id, qty) {
  if(qty < 1 || qty > 99) return;
  
  try {
    await db.collection('houses').doc(HOUSE_CODE).collection('items').doc(id).update({
      qty,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
      updatedBy: DEVICE_ID
    });
  } catch(error) {
    console.error('Erro ao atualizar quantidade:', error);
    toast('❌ Erro ao atualizar quantidade', 'error');
  }
}

async function deleteItem(id) {
  try {
    await db.collection('houses').doc(HOUSE_CODE).collection('items').doc(id).delete();
    toast('🗑️ Item removido');
  } catch(error) {
    console.error('Erro ao deletar:', error);
    toast('❌ Erro ao remover item', 'error');
  }
}

async function clearChecked(){
  const checkedItems = items.filter(item => item.checked);
  if(checkedItems.length === 0) return toast('ℹ️ Nenhum item comprado para limpar');
  
  if(!confirm(`Remover ${checkedItems.length} itens comprados?`)) return;
  
  const batch = db.batch();
  const ref = db.collection('houses').doc(HOUSE_CODE).collection('items');
  
  checkedItems.forEach(item => {
    batch.delete(ref.doc(item.id));
  });
  
  try {
    await batch.commit();
    toast(`🗑️ ${checkedItems.length} itens removidos`);
  } catch(error) {
    console.error('Erro ao limpar:', error);
    toast('❌ Erro ao limpar lista', 'error');
  }
}

async function clearAll(){
  if(items.length === 0) return toast('ℹ️ Lista já está vazia');
  
  if(!confirm(`⚠️ Remover TODOS os ${items.length} itens da lista?`)) return;
  
  const batch = db.batch();
  const ref = db.collection('houses').doc(HOUSE_CODE).collection('items');
  
  items.forEach(item => {
    batch.delete(ref.doc(item.id));
  });
  
  try {
    await batch.commit();
    toast('🗑️ Lista completamente limpa');
  } catch(error) {
    console.error('Erro ao limpar tudo:', error);
    toast('❌ Erro ao limpar lista', 'error');
  }
}

function exportList() {
  if(items.length === 0) return toast('ℹ️ Lista vazia para exportar');
  
  const pending = items.filter(item => !item.checked);
  const text = pending.map(item => `${item.name} (${item.qty}x) - ${item.category}`).join('\n');
  
  if(navigator.share) {
    navigator.share({
      title: `Lista de Compras - ${HOUSE_CODE}`,
      text: `📝 Lista de Compras:\n\n${text}`
    });
  } else {
    navigator.clipboard.writeText(text);
    toast('📤 Lista copiada para área de transferência');
  }
}

/* ===== Render e Utilitários ===== */
function render(){
  const q = $("#search").value.toLowerCase();
  const cat = $("#filterCat").value;
  const list = $("#list");
  const emptyState = $("#emptyState");
  
  list.innerHTML = '';
  
  let filtered = items.filter(item => {
    const matchName = !q || item.name.toLowerCase().includes(q);
    const matchCat = !cat || item.category === cat;
    return matchName && matchCat;
  });
  
  if(filtered.length === 0) {
    emptyState.style.display = 'block';
    list.style.display = 'none';
    return;
  }
  
  emptyState.style.display = 'none';
  list.style.display = 'grid';
  
  filtered.forEach(item => {
    const row = document.createElement('div');
    row.className = `item ${item.checked ? 'checked' : ''}`;
    
    // Checkbox
    const cb = document.createElement('input');
    cb.type = 'checkbox';
    cb.className = 'checkbox';
    cb.checked = !!item.checked;
    cb.onchange = () => toggleCheck(item.id, cb.checked);
    
    // Info do item
    const info = document.createElement('div');
    const name = document.createElement('div');
    name.textContent = item.name;
    if(item.checked) name.style.textDecoration = 'line-through';
    
    const cat = document.createElement('div');
    cat.className = 'cat';
    cat.textContent = item.category || '📂 Sem categoria';
    
    info.append(name, cat);
    
    // Quantidade
   const qtyInput = document.createElement('input');
   qtyInput.type = 'number';
   qtyInput.className = 'qty';
   qtyInput.value = item.qty || 1;
   qtyInput.min = '1';
   qtyInput.max = '99';
   qtyInput.onchange = () => updateQty(item.id, parseInt(qtyInput.value));
   
   // Botão de deletar
   const deleteBtn = document.createElement('button');
   deleteBtn.textContent = '🗑️';
   deleteBtn.className = 'btn-danger';
   deleteBtn.style.padding = '8px';
   deleteBtn.style.minWidth = '40px';
   deleteBtn.onclick = () => {
     if(confirm(`Remover "${item.name}"?`)) {
       deleteItem(item.id);
     }
   };
   
   row.append(cb, info, qtyInput, deleteBtn);
   list.appendChild(row);
 });
}

function updateStats() {
 const total = items.length;
 const checked = items.filter(item => item.checked).length;
 const pending = total - checked;
 
 $("#totalItems").textContent = total;
 $("#checkedItems").textContent = checked;
 $("#pendingItems").textContent = pending;
}

function validateQty() {
 const input = $("#itemQty");
 let value = parseInt(input.value);
 
 if(isNaN(value) || value < 1) value = 1;
 if(value > 99) value = 99;
 
 input.value = value;
}

// Debounce para busca
function debounce(func, wait) {
 let timeout;
 return function executedFunction(...args) {
   const later = () => {
     clearTimeout(timeout);
     func(...args);
   };
   clearTimeout(timeout);
   timeout = setTimeout(later, wait);
 };
}

/* ===== PWA e Service Worker ===== */
if ('serviceWorker' in navigator) {
 window.addEventListener('load', () => {
   navigator.serviceWorker.register('/sw.js')
     .then(() => console.log('SW registered'))
     .catch(() => console.log('SW registration failed'));
 });
}

/* ===== Inicialização ===== */
start();
</script>
</body>
</html>
