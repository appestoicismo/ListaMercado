<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Lista de Compras</title>
<meta name="theme-color" content="#0f172a">
<link rel="manifest" href="manifest.json">

<style>
  :root{
    --bg:#0f172a;--card:#111827;--muted:#94a3b8;--fg:#e5e7eb;
    --accent:#22c55e;--accent-2:#16a34a;--danger:#ef4444;--warning:#f59e0b;
  }
  *{box-sizing:border-box}
  body{
    margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    background:var(--bg);color:var(--fg);line-height:1.5;
  }
  
  header{
    position:sticky;top:0;z-index:10;background:linear-gradient(180deg,#0f172a,#0f172acc);
    backdrop-filter:blur(10px);padding:12px 16px;border-bottom:1px solid #1f2937;
  }
  
  .row{display:flex;gap:12px;align-items:center}
  .col{display:flex;flex-direction:column;gap:8px}
  .brand{font-weight:700;letter-spacing:.3px;font-size:1.1rem}
  .chip{
    font-size:.8rem;color:var(--muted);border:1px solid #1f2937;
    border-radius:999px;padding:6px 12px;background:#0b1220;
  }
  
  .wrap{max-width:800px;margin:0 auto;padding:16px}
  .card{
    background:var(--card);border:1px solid #1f2937;
    border-radius:16px;padding:16px;margin-bottom:16px;
  }
  
  input,select,button{
    border-radius:12px;border:1px solid #334155;background:#0b1220;
    color:var(--fg);padding:12px 14px;font-size:1rem;transition:all .2s ease;
  }
  
  input:focus,select:focus{outline:none;border-color:var(--accent)}
  input::placeholder{color:#64748b}
  
  button{
    background:var(--accent);border:none;color:#04210f;
    font-weight:600;cursor:pointer;transition:all .2s ease;
  }
  button:hover{background:var(--accent-2)}
  
  .btn-ghost{background:#0b1220;border:1px solid #223147;color:var(--fg)}
  .btn-danger{background:var(--danger);color:white}
  .btn-warning{background:var(--warning);color:#0c0a09}
  
  .grid{display:grid;gap:12px;align-items:center}
  .grid-2{grid-template-columns:1fr auto}
  .grid-3{grid-template-columns:1fr auto auto}
  .grid-4{grid-template-columns:1fr auto auto auto}
  
  .list{margin-top:16px;display:grid;gap:10px}
  .item{
    display:grid;grid-template-columns:auto 1fr auto auto;align-items:center;
    gap:12px;background:#0b1220;border:1px solid #223147;border-radius:14px;
    padding:12px;transition:all .2s ease;
  }
  .item.checked{opacity:.6}
  
  .qty{
    min-width:50px;text-align:center;border:1px solid #223147;
    border-radius:10px;padding:8px 10px;background:#0b1220;color:var(--fg);
  }
  
  .cat{font-size:.85rem;color:var(--muted)}
  .muted{color:var(--muted)}
  .small{font-size:.9rem}
  
  .tools{display:flex;flex-wrap:wrap;gap:12px;margin:16px 0;align-items:center}
  .stats{display:flex;gap:16px;flex-wrap:wrap;margin:12px 0}
  .stat{
    background:#0b1220;border:1px solid #223147;border-radius:8px;
    padding:8px 12px;text-align:center;
  }
  .stat-num{font-size:1.2rem;font-weight:700;color:var(--accent)}
  .stat-label{font-size:.8rem;color:var(--muted)}
  
  .templates{margin:16px 0}
  .template-btn{
    background:#1e293b;border:1px solid #334155;color:var(--fg);
    margin:4px;padding:8px 12px;border-radius:8px;cursor:pointer;font-size:.9rem;
  }
  
  .footer{
    margin:32px 0 16px;color:#64748b;font-size:.9rem;text-align:center;
    border-top:1px solid #1f2937;padding-top:16px;
  }
  
  .toast{
    position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
    background:#0b1220;border:1px solid #334155;color:#e5e7eb;
    padding:12px 16px;border-radius:12px;opacity:0;
    transition:all .3s ease;z-index:999;
  }
  .toast.show{opacity:1}
  
  @media (max-width: 640px) {
    .wrap{padding:12px}
    .grid-3{grid-template-columns:1fr auto}
    .grid-4{grid-template-columns:1fr auto}
  }
</style>
</head>

<body>
<header class="wrap">
  <div class="row" style="justify-content:space-between">
    <div class="col" style="gap:4px">
      <div class="brand">ğŸ›’ Lista de Compras</div>
      <div class="small">Funciona 100% offline</div>
    </div>
    <div class="chip">Local</div>
  </div>
</header>

<main class="wrap">
  <section class="card">
    <div class="stats">
      <div class="stat">
        <div class="stat-num" id="totalItems">0</div>
        <div class="stat-label">Total</div>
      </div>
      <div class="stat">
        <div class="stat-num" id="pendingItems">0</div>
        <div class="stat-label">Pendentes</div>
      </div>
      <div class="stat">
        <div class="stat-num" id="checkedItems">0</div>
        <div class="stat-label">Comprados</div>
      </div>
    </div>

    <div class="grid grid-2">
      <input id="search" placeholder="ğŸ” Buscar itemâ€¦">
      <select id="filterCat">
        <option value="">ğŸ“‚ Todas categorias</option>
        <option>ğŸ¥¬ Hortifruti</option>
        <option>ğŸ›’ Mercearia</option>
        <option>ğŸ§½ Limpeza</option>
        <option>ğŸ¥¤ Bebidas</option>
        <option>ğŸ§´ Higiene</option>
        <option>ğŸ¥– Padaria</option>
      </select>
    </div>

    <div class="grid grid-4" style="margin-top:16px">
      <input id="itemName" placeholder="â• Novo item">
      <select id="itemCat">
        <option>ğŸ›’ Mercearia</option>
        <option>ğŸ¥¬ Hortifruti</option>
        <option>ğŸ§½ Limpeza</option>
        <option>ğŸ¥¤ Bebidas</option>
        <option>ğŸ§´ Higiene</option>
        <option>ğŸ¥– Padaria</option>
      </select>
      <input id="itemQty" type="number" value="1" min="1" max="99" style="max-width:70px">
      <button id="addBtn">Adicionar</button>
    </div>

    <div class="templates">
      <div style="margin-bottom:8px"><strong>ğŸ“‹ Templates:</strong></div>
      <div>
        <button class="template-btn" data-template="basicos">ğŸ¥£ BÃ¡sicos</button>
        <button class="template-btn" data-template="limpeza">ğŸ§½ Limpeza</button>
        <button class="template-btn" data-template="higiene">ğŸ§´ Higiene</button>
        <button class="template-btn" data-template="frutas">ğŸ Frutas</button>
      </div>
    </div>

    <div class="tools">
      <button id="clearChecked" class="btn-danger">ğŸ—‘ï¸ Limpar Comprados</button>
      <button id="clearAll" class="btn-warning">âš ï¸ Limpar Tudo</button>
      <button id="exportList" class="btn-ghost">ğŸ“¤ Exportar</button>
    </div>

    <div id="list" class="list"></div>

    <div id="emptyState" style="text-align:center;padding:32px;color:var(--muted);display:none">
      ğŸ“<br><br><strong>Lista vazia!</strong><br>Adicione itens ou use um template.
    </div>
  </section>
</main>

<div class="footer">
  <div><strong>Lista de Compras Local</strong></div>
  <div class="small muted">Dados salvos no seu dispositivo</div>
</div>

<div class="toast" id="toast">âœ… Pronto!</div>

<script>
const TEMPLATES = {
  basicos: [
    {name: 'Arroz', cat: 'ğŸ›’ Mercearia'}, 
    {name: 'FeijÃ£o', cat: 'ğŸ›’ Mercearia'},
    {name: 'AÃ§Ãºcar', cat: 'ğŸ›’ Mercearia'}, 
    {name: 'Ã“leo', cat: 'ğŸ›’ Mercearia'}
  ],
  limpeza: [
    {name: 'Detergente', cat: 'ğŸ§½ Limpeza'}, 
    {name: 'SabÃ£o em pÃ³', cat: 'ğŸ§½ Limpeza'},
    {name: 'Papel higiÃªnico', cat: 'ğŸ§½ Limpeza'}
  ],
  higiene: [
    {name: 'Pasta de dente', cat: 'ğŸ§´ Higiene'}, 
    {name: 'Sabonete', cat: 'ğŸ§´ Higiene'},
    {name: 'Shampoo', cat: 'ğŸ§´ Higiene'}
  ],
  frutas: [
    {name: 'Banana', cat: 'ğŸ¥¬ Hortifruti'}, 
    {name: 'MaÃ§Ã£', cat: 'ğŸ¥¬ Hortifruti'},
    {name: 'Laranja', cat: 'ğŸ¥¬ Hortifruti'}
  ]
};

const $ = sel => document.querySelector(sel);
const toast = msg => { 
  const t = $("#toast"); 
  t.textContent = msg; 
  t.classList.add('show'); 
  setTimeout(() => t.classList.remove('show'), 2000); 
};

let items = JSON.parse(localStorage.getItem('lista-compras') || '[]');

function saveItems() {
  localStorage.setItem('lista-compras', JSON.stringify(items));
}

function addItem() {
  const name = $("#itemName").value.trim();
  const category = $("#itemCat").value;
  const qty = parseInt($("#itemQty").value) || 1;
  
  if(!name) return toast('âŒ Digite o nome do item');
  
  const exists = items.some(item => item.name.toLowerCase() === name.toLowerCase() && !item.checked);
  if(exists) return toast('âš ï¸ Item jÃ¡ existe');
  
  items.push({
    id: Date.now(),
    name,
    category,
    qty,
    checked: false
  });
  
  $("#itemName").value = '';
  $("#itemQty").value = '1';
  saveItems();
  render();
  toast(`â• ${name} adicionado!`);
}

function addTemplate(template) {
  const templateItems = TEMPLATES[template];
  let added = 0;
  
  templateItems.forEach(item => {
    const exists = items.some(existing => 
      existing.name.toLowerCase() === item.name.toLowerCase() && !existing.checked
    );
    
    if(!exists) {
      items.push({
        id: Date.now() + Math.random(),
        name: item.name,
        category: item.cat,
        qty: 1,
        checked: false
      });
      added++;
    }
  });
  
  if(added > 0) {
    saveItems();
    render();
    toast(`ğŸ“‹ ${added} itens adicionados!`);
  }
}

function toggleCheck(id) {
  const item = items.find(i => i.id === id);
  if(item) {
    item.checked = !item.checked;
    saveItems();
    render();
  }
}

function updateQty(id, qty) {
  const item = items.find(i => i.id === id);
  if(item && qty >= 1 && qty <= 99) {
    item.qty = qty;
    saveItems();
    render();
  }
}

function deleteItem(id) {
  items = items.filter(i => i.id !== id);
  saveItems();
  render();
  toast('ğŸ—‘ï¸ Item removido');
}

function clearChecked() {
  const checkedCount = items.filter(i => i.checked).length;
  if(checkedCount === 0) return toast('â„¹ï¸ Nenhum item comprado');
  
  if(confirm(`Remover ${checkedCount} itens comprados?`)) {
    items = items.filter(i => !i.checked);
    saveItems();
    render();
    toast(`ğŸ—‘ï¸ ${checkedCount} itens removidos`);
  }
}

function clearAll() {
  if(items.length === 0) return toast('â„¹ï¸ Lista jÃ¡ vazia');
  
  if(confirm(`Remover TODOS os ${items.length} itens?`)) {
    items = [];
    saveItems();
    render();
    toast('ğŸ—‘ï¸ Lista limpa');
  }
}

function exportList() {
  if(items.length === 0) return toast('â„¹ï¸ Lista vazia');
  
  const pending = items.filter(i => !i.checked);
  const text = pending.map(i => `${i.name} (${i.qty}x) - ${i.category}`).join('\n');
  
  if(navigator.share) {
    navigator.share({
      title: 'Lista de Compras',
      text: `ğŸ“ Lista de Compras:\n\n${text}`
    });
  } else {
    navigator.clipboard.writeText(text);
    toast('ğŸ“¤ Lista copiada!');
  }
}

function render() {
  const q = $("#search").value.toLowerCase();
  const cat = $("#filterCat").value;
  const list = $("#list");
  const emptyState = $("#emptyState");
  
  list.innerHTML = '';
  
  let filtered = items.filter(item => {
    const matchName = !q || item.name.toLowerCase().includes(q);
    const matchCat = !cat || item.category === cat;
    return matchName && matchCat;
  });
  
  // Sort: unchecked first
  filtered.sort((a, b) => a.checked - b.checked);
  
  if(filtered.length === 0) {
    emptyState.style.display = 'block';
    list.style.display = 'none';
  } else {
    emptyState.style.display = 'none';
    list.style.display = 'grid';
    
    filtered.forEach(item => {
      const row = document.createElement('div');
      row.className = `item ${item.checked ? 'checked' : ''}`;
      
      const cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.checked = item.checked;
      cb.onchange = () => toggleCheck(item.id);
      
      const info = document.createElement('div');
      const name = document.createElement('div');
      name.textContent = item.name;
      if(item.checked) name.style.textDecoration = 'line-through';
      
      const cat = document.createElement('div');
      cat.className = 'cat';
      cat.textContent = item.category;
      
      info.append(name, cat);
      
      const qtyInput = document.createElement('input');
      qtyInput.type = 'number';
      qtyInput.className = 'qty';
      qtyInput.value = item.qty;
      qtyInput.min = '1';
      qtyInput.max = '99';
      qtyInput.onchange = () => updateQty(item.id, parseInt(qtyInput.value));
      
      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'ğŸ—‘ï¸';
      deleteBtn.className = 'btn-danger';
      deleteBtn.style.padding = '8px';
      deleteBtn.onclick = () => deleteItem(item.id);
      
      row.append(cb, info, qtyInput, deleteBtn);
      list.appendChild(row);
    });
  }
  
  // Update stats
  const total = items.length;
  const checked = items.filter(i => i.checked).length;
  const pending = total - checked;
  
  $("#totalItems").textContent = total;
  $("#checkedItems").textContent = checked;
  $("#pendingItems").textContent = pending;
}

// Event listeners
$("#addBtn").onclick = addItem;
$("#search").oninput = render;
$("#filterCat").onchange = render;
$("#clearChecked").onclick = clearChecked;
$("#clearAll").onclick = clearAll;
$("#exportList").onclick = exportList;

$("#itemName").addEventListener('keypress', e => {
  if(e.key === 'Enter') addItem();
});

document.querySelectorAll('.template-btn').forEach(btn => {
  btn.onclick = () => addTemplate(btn.dataset.template);
});

// Initial render
render();
</script>
</body>
</html>
